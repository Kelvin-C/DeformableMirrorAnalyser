Version 4
SHEET 1 1024 992
WIRE 624 -112 624 -128
WIRE 512 -16 512 -48
WIRE 624 -16 624 -48
WIRE 624 -16 512 -16
WIRE 816 -16 624 -16
WIRE 512 0 512 -16
WIRE -368 112 -384 112
WIRE -160 112 -304 112
WIRE -64 112 -80 112
WIRE 64 112 -64 112
WIRE 112 112 64 112
WIRE 336 112 192 112
WIRE 432 112 336 112
WIRE 512 112 512 80
WIRE 512 112 432 112
WIRE 672 112 512 112
WIRE 784 112 752 112
WIRE 880 112 784 112
WIRE -384 160 -384 112
WIRE -64 160 -64 112
WIRE 64 160 64 112
WIRE 336 160 336 112
WIRE 432 160 432 112
WIRE 784 160 784 112
WIRE -384 288 -384 240
WIRE -64 304 -64 224
WIRE 64 304 64 224
WIRE 336 304 336 224
WIRE 432 304 432 240
WIRE 784 304 784 224
FLAG -384 288 0
FLAG 432 304 0
FLAG 784 304 0
FLAG 880 112 PZ_Out
IOPIN 880 112 Out
FLAG 336 304 0
FLAG -64 304 0
FLAG 64 304 0
FLAG 512 -128 0
FLAG 624 -128 0
FLAG 816 -16 ADC
IOPIN 816 -16 Out
SYMBOL voltage -384 144 R0
WINDOW 3 24 96 Invisible 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
WINDOW 0 -85 54 Left 2
SYMATTR Value PULSE(0 90 0 0.00005 0.000008 {Ton} {Tperiod} {N})
SYMATTR InstName V1
SYMBOL res 416 144 R0
WINDOW 0 45 36 Left 2
WINDOW 3 45 76 Left 2
SYMATTR InstName R1
SYMATTR Value 24k
SYMBOL res 768 96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1m
SYMBOL polcap 768 160 R0
WINDOW 3 46 60 Left 2
WINDOW 0 35 6 Left 2
SYMATTR Value 0.3µ
SYMATTR InstName C1
SYMATTR Description Capacitor
SYMATTR Type cap
SYMATTR SpiceLine V=200 Irms=0 Rser=0.15 Lser=0
SYMBOL polcap 320 160 R0
WINDOW 3 42 55 Left 2
SYMATTR Value 4.7µ
SYMATTR InstName C3
SYMATTR Description Capacitor
SYMATTR Type cap
SYMATTR SpiceLine V=200 Irms=0 Rser=6.6 Lser=0
SYMBOL ind 208 96 R90
WINDOW 0 5 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName L1
SYMATTR Value 0.1
SYMATTR SpiceLine Rser=242
SYMBOL res -64 96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 43 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 12k
SYMBOL cap -80 160 R0
SYMATTR InstName C4
SYMATTR Value 4.7µ
SYMATTR SpiceLine V=310 Rser=0.02 Lser=0
SYMBOL cap 48 160 R0
SYMATTR InstName C5
SYMATTR Value 4.7µ
SYMATTR SpiceLine V=310 Rser=0.02 Lser=0
SYMBOL diode -368 128 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMBOL res 528 96 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R3
SYMATTR Value 1Meg
SYMBOL res 528 -32 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R5
SYMATTR Value 35k
SYMBOL cap 608 -112 R0
SYMATTR InstName C2
SYMATTR Value 3.3µ
TEXT -504 328 Left 2 !.tran 0 4 0 0.0005
TEXT -504 360 Left 2 !.save V(pz_out)\n.save V(meas_v)\n*.step param C 1u 100u 1u\n*.step param C0 100n 1u 100n\n*.step param C0 list 2.2p 1u\n*.step dec param C0 1n 1u 2\n*.step param Ton 0 0.001 0.00005\n*.step param R0 6k 20k 2k\n.param R0 1\n.param Ton 0.0002\n.param C 4.7u\n.param R1 1k\n.param Tperiod 0.001\n.param N 200000\n.param start_time 2\n.param stop_time 4\n*.MEAS Voltage_AVG AVG V(meas_v) TRIG AT=2 TARG AT=N*Tperiod\n.MEAS Voltage_AVG AVG V(meas_v) TRIG AT=start_time TARG AT=stop_time\n.MEAS Timeto99 WHEN V(meas_v) = 0.99*Voltage_AVG \n.MEAS TimetoAVG WHEN V(meas_v) = Voltage_AVG \n.MEAS Vpkpk PP V(meas_v)TRIG AT=TimetoAVG TARG AT=stop_time\n.MEAS temp_T_Discharge WHEN V(meas_v) = 0.01*Voltage_AVG TD=stop_time\n*.MEAS T_Discharge WHEN time = temp_T_Discharge-stop_time
